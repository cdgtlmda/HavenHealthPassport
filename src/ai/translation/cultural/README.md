# Cultural Adaptation System

This module provides comprehensive cultural adaptation for medical translations, ensuring appropriate and respectful communication across cultural boundaries.

## Overview

The cultural adaptation system handles:
- Communication style differences (direct vs indirect)
- Formality levels and honorifics
- Religious and dietary considerations
- Healthcare system variations
- Privacy and family involvement expectations
- Taboo topics and euphemisms
- Measurement and date format conversions

## Components

### 1. Cultural Profiles (`cultural_profiles.py`)
Defines comprehensive cultural profiles for 50+ languages/regions including:
- Communication preferences
- Authority relationships
- Privacy expectations
- Religious considerations
- Healthcare beliefs
- Taboo topics and euphemisms

### 2. Adaptation Rules (`adaptation_rules.py`)
Implements specific adaptation rules:
- Formality adjustments
- Euphemism replacements
- Measurement conversions
- Date format localization
- Family involvement adaptations
- Communication style modifications

### 3. Healthcare Systems (`healthcare_systems.py`)
Handles healthcare system differences:
- Provider titles (Doctor vs GP)
- Emergency services (ER vs A&E)
- Referral requirements
- Insurance terminology
- Prescription practices

### 4. Cultural Integration (`cultural_integration.py`)
Integrates cultural adaptation with translation pipeline:
- Pre/post-processing for cultures
- Cultural validation
- Provider guidance notes
- Complete adaptation workflow

## Usage

```python
from src.ai.translation.cultural import cultural_translation_pipeline

# Create culturally adapted translation request
request = CulturallyAdaptedTranslationRequest(
    text="Take 2 tablets for severe pain. Temperature 100°F. Discuss options with family.",
    source_lang="en",
    target_lang="ar",
    source_country="US",
    target_country="SA"
)

# Perform translation with cultural adaptation
result = await cultural_translation_pipeline.translate_with_cultural_adaptation(
    request, translation_function
)

# Access results
print(f"Adapted text: {result.translated_text}")
print(f"Cultural notes: {result.cultural_notes}")
print(f"Warnings: {result.warnings}")
```

## Cultural Profiles

### Supported Cultures
- **Arabic (ar)**: Indirect communication, high formality, Islamic considerations
- **Chinese (zh)**: High-context, holistic health approach, family decisions
- **Spanish-LA (es-LA)**: Indirect, family-oriented, flexible time
- **Somali (so)**: Very high privacy, collective decisions, gender preferences
- **Japanese (ja)**: High-context, minimal pain expression, individual decisions

### Key Adaptations

#### Communication Styles
- **Direct → Indirect**: Softens commands, adds politeness
- **Low-context → High-context**: Adds explanations, context
- **Individual → Collective**: Includes family in decisions

#### Religious/Dietary
- Identifies restricted items (pork, alcohol)
- Notes gender preferences for providers
- Handles fasting periods (Ramadan)
- Respects end-of-life beliefs

#### Measurements
- Fahrenheit ↔ Celsius
- Pounds ↔ Kilograms
- US dates ↔ ISO/EU formats
- Imperial ↔ Metric

## Healthcare System Adaptations

### US → UK
- Emergency Room → A&E
- Doctor → GP
- Medications → Medicines
- Insurance terms → NHS terms

### Provider Notes
The system generates helpful notes for healthcare providers:
- Communication style expectations
- Family involvement norms
- Pain expression patterns
- Decision-making processes

## Validation

```python
# Validate cultural appropriateness
validation = cultural_translation_pipeline.validate_cultural_appropriateness(
    text="Direct discussion about mental health",
    target_culture="ar"
)

if not validation["valid"]:
    print(f"Issues: {validation['issues']}")
    print(f"Recommendations: {validation['recommendations']}")
```

## Configuration

### Adding Cultural Profiles
```python
from src.ai.translation.cultural import CulturalProfile, cultural_profile_manager

profile = CulturalProfile(
    language_code="xx",
    name="Language Name",
    communication_style=CommunicationStyle.INDIRECT,
    # ... other settings
)

cultural_profile_manager.add_profile(profile)
```

### Custom Adaptation Rules
```python
from src.ai.translation.cultural import AdaptationRule, cultural_adapter

rule = AdaptationRule(
    name="custom_rule",
    adaptation_type=AdaptationType.EUPHEMISM,
    source_pattern=r'\bsensitive_term\b',
    target_template="polite_alternative"
)

cultural_adapter.add_rule(rule)
```

## Best Practices

1. **Always specify both language and country** when possible
2. **Review cultural notes** generated by the system
3. **Validate appropriateness** before sending to patients
4. **Test with native speakers** for accuracy
5. **Update profiles** based on feedback

## Integration

The cultural adaptation system integrates seamlessly with:
- Context preservation system
- Glossary matching
- Medical NLP components
- Quality assurance pipeline

## Performance

- Minimal overhead on translation
- Caching for repeated adaptations
- Async processing support
- Configurable adaptation levels
